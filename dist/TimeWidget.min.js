// undefined v0.0.25 Copyright 2025 IvÃ¡n Velasco GonzÃ¡lez & John Alexis Guerra GÃ³mez
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("d3")):"function"==typeof define&&define.amd?define(["d3"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).TimeWidget=t(e.d3)}(this,(function(e){"use strict";function t(e){var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var n=t(e);function r(e){if(null===e||!0===e||!1===e)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}function o(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function i(e){o(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||"object"===a(e)&&"[object Date]"===t?new Date(e.getTime()):"number"==typeof e||"[object Number]"===t?new Date(e):("string"!=typeof e&&"[object String]"!==t||"undefined"==typeof console||(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn((new Error).stack)),new Date(NaN))}function s(e,t){o(2,arguments);var n=i(e),a=r(t);return isNaN(a)?new Date(NaN):a?(n.setDate(n.getDate()+a),n):n}function l(e,t){o(2,arguments);var n=i(e),a=r(t);if(isNaN(a))return new Date(NaN);if(!a)return n;var s=n.getDate(),l=new Date(n.getTime());l.setMonth(n.getMonth()+a+1,0);var c=l.getDate();return s>=c?l:(n.setFullYear(l.getFullYear(),l.getMonth(),s),n)}function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function u(e,t){if(o(2,arguments),!t||"object"!==c(t))return new Date(NaN);var n=t.years?r(t.years):0,a=t.months?r(t.months):0,u=t.weeks?r(t.weeks):0,d=t.days?r(t.days):0,h=t.hours?r(t.hours):0,f=t.minutes?r(t.minutes):0,p=t.seconds?r(t.seconds):0,g=i(e),m=a||n?l(g,a+12*n):g,b=d||u?s(m,d+7*u):m,v=f+60*h,y=p+60*v,x=1e3*y,w=new Date(b.getTime()+x);return w}function d(e){var t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),e.getTime()-t.getTime()}function h(e){o(1,arguments);var t=i(e);return t.setHours(0,0,0,0),t}var f=864e5;function p(e,t){o(2,arguments);var n=h(e),r=h(t),a=n.getTime()-d(n),i=r.getTime()-d(r);return Math.round((a-i)/f)}function g(e,t){o(2,arguments);var n=i(e),r=i(t),a=n.getTime()-r.getTime();return a<0?-1:a>0?1:a}var m=36e5;function b(e,t){o(2,arguments);var n=i(e),r=i(t),a=n.getFullYear()-r.getFullYear(),s=n.getMonth()-r.getMonth();return 12*a+s}function v(e,t){o(2,arguments);var n=i(e),r=i(t);return n.getFullYear()-r.getFullYear()}function y(e,t){var n=e.getFullYear()-t.getFullYear()||e.getMonth()-t.getMonth()||e.getDate()-t.getDate()||e.getHours()-t.getHours()||e.getMinutes()-t.getMinutes()||e.getSeconds()-t.getSeconds()||e.getMilliseconds()-t.getMilliseconds();return n<0?-1:n>0?1:n}function x(e,t){o(2,arguments);var n=i(e),r=i(t),a=y(n,r),s=Math.abs(p(n,r));n.setDate(n.getDate()-a*s);var l=Number(y(n,r)===-a),c=a*(s-l);return 0===c?0:c}function w(e,t){return o(2,arguments),i(e).getTime()-i(t).getTime()}var S={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(e){return e<0?Math.ceil(e):Math.floor(e)}};function k(e){return e?S[e]:S.trunc}function B(e,t,n){o(2,arguments);var r=w(e,t)/m;return k(null==n?void 0:n.roundingMethod)(r)}function A(e,t,n){o(2,arguments);var r=w(e,t)/6e4;return k(null==n?void 0:n.roundingMethod)(r)}function C(e){o(1,arguments);var t=i(e);return t.setHours(23,59,59,999),t}function M(e){o(1,arguments);var t=i(e),n=t.getMonth();return t.setFullYear(t.getFullYear(),n+1,0),t.setHours(23,59,59,999),t}function _(e){o(1,arguments);var t=i(e);return C(t).getTime()===M(t).getTime()}function E(e,t){o(2,arguments);var n,r=i(e),a=i(t),s=g(r,a),l=Math.abs(b(r,a));if(l<1)n=0;else{1===r.getMonth()&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-s*l);var c=g(r,a)===-s;_(i(e))&&1===l&&1===g(e,a)&&(c=!1),n=s*(l-Number(c))}return 0===n?0:n}function G(e,t,n){o(2,arguments);var r=w(e,t)/1e3;return k(null==n?void 0:n.roundingMethod)(r)}function T(e,t){o(2,arguments);var n=i(e),r=i(t),a=g(n,r),s=Math.abs(v(n,r));n.setFullYear(1584),r.setFullYear(1584);var l=g(n,r)===-a,c=a*(s-Number(l));return 0===c?0:c}function D(e){o(1,arguments);var t=i(e.start),n=i(e.end);if(isNaN(t.getTime()))throw new RangeError("Start Date is invalid");if(isNaN(n.getTime()))throw new RangeError("End Date is invalid");var r={};r.years=Math.abs(T(n,t));var a=g(n,t),s=u(t,{years:a*r.years});r.months=Math.abs(E(n,s));var l=u(s,{months:a*r.months});r.days=Math.abs(x(n,l));var c=u(l,{days:a*r.days});r.hours=Math.abs(B(n,c));var d=u(c,{hours:a*r.hours});r.minutes=Math.abs(A(n,d));var h=u(d,{minutes:a*r.minutes});return r.seconds=Math.abs(G(n,h)),r}function N(e,t){o(2,arguments);var n=r(t);return s(e,-n)}function $(e,t){o(2,arguments);var n=r(t);return l(e,-n)}function Y(e){return Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Y(e)}function R(e,t){if(o(2,arguments),!t||"object"!==Y(t))return new Date(NaN);var n=t.years?r(t.years):0,a=t.months?r(t.months):0,i=t.weeks?r(t.weeks):0,s=t.days?r(t.days):0,l=t.hours?r(t.hours):0,c=t.minutes?r(t.minutes):0,u=t.seconds?r(t.seconds):0,d=$(e,a+12*n),h=N(d,s+7*i),f=c+60*l,p=u+60*f,g=1e3*p,m=new Date(h.getTime()-g);return m}let L=0;function P(){console.log(performance.now()-L,...arguments),L=performance.now()}function X(e,t=1){const{l:r,c:o,h:a}=n.lch(e);return n.lch(r-18*t,o,a)}function j(e,t){if(e===t)return!0;if(null===e)return!1;if(null===t)return!1;if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function O(e,t,n){let r=t.domain(),o=n.domain(),a=[e[0][0],e[1][0]],i=[e[1][1],e[0][1]];return a[0]>r[0]&&a[1]<r[1]&&i[0]>o[0]&&i[1]<o[1]}const z=Object.freeze({changeSelection:"changeSelection",addBrushGroup:"newBrushGroup",removeBrushGroup:"deleteBrushGroup",selectBrushGroup:"selectBrushGroup",changeNonSelected:"changeNonSelected",changeBrushGroupState:"changeBrushGroupState",deselectAllBrushes:"deselectAllBrushes",highlightSelection:"highlightSelection",update:"update"}),H=Object.freeze({Intersect:"intersect",Contains:"contains"}),F=Object.freeze({And:"and",Or:"OR"});function W({ts:e,detailsElement:t,detailsContainerHeight:r,detailsWidth:o,maxDetailsRecords:a,detailsHeight:i,x:s,y:l,margin:c={left:50,top:10,bottom:20,right:0}}={}){const u={};let d=new Map;const h=n.select(t).attr("id","detail").style("height",`${r}px`).style("width",`${o}px`).style("overflow-y","scroll").node(),f=n.line().defined((e=>void 0!==l(e)&&null!==l(e)));let p,g;function m({data:e,brushGroupSelected:t}){let r=a?e.get(t).slice(0,a):e.get(t);h.innerHTML="",n.select(h).selectAll("div.detailsContainer").data(r,(e=>e[0])).join("div").attr("class","detailsContainer").attr("group",(e=>e[0])).each((function(e){!function({points:e=[],width:t=600,height:r=300,margin:o={top:10,left:40,right:10,bottom:10},xScale:a=n.scaleLinear().range([0,t]),yScale:i=n.scaleLinear().range([r,0]),x:s=(e=>e[0]),y:l=(e=>e[1]),line:c=n.line(),title:u="",target:d=null,renderer:h="canvas",pointRadius:f=1.5,strokeColor:p="#777"}={}){let g=(d?n.select(d):n.create("div")).attr("class","details").style("position","relative");g.selectAll("*").remove();let m=g.append("canvas").style("position","absolute").style("top",`${o.top}px`).style("left",`${o.left}px`).style("height",r+"px").style("width",t+"px").style("pointer-events","none"),b=m.node().getContext("2d");const v=window.devicePixelRatio||1;m.attr("height",Math.floor(r*v)).attr("width",Math.floor(t*v)),b.scale(v,v);let y=g.append("svg").attr("viewBox",[0,0,t,r]).attr("height",r).attr("width",t).append("g").attr("class","gDrawing").attr("transform",`translate(${o.left}, ${o.top})`);if(y.append("g").attr("class","detailsYAxis").call(n.axisLeft(i).ticks(Math.floor(r/30))),y.append("g").attr("class","detailsXAxis").call(n.axisBottom(a)).attr("transform",`translate(0, ${r-o.top-o.bottom})`),y.append("text").text(u).attr("transform","translate(10, 0)").style("fill",p).style("font-size","0.7em"),"SVG"==h.toUpperCase())y.append("path").attr("d",c(e)).style("fill","none").style("stroke",p),y.append("points").selectAll("circle").data(e).join("circle").attr("cx",(e=>a(s(e)))).attr("cx",(e=>a(s(e)))).attr("r",f).attr("stroke",p);else{let t=new Path2D(c(e));b.strokeStyle=p,b.stroke(t),b.beginPath();for(let t of e)b.moveTo(a(s(t))+f,i(l(t))+f),b.arc(a(s(t)),i(l(t)),f,0,2*Math.PI);b.stroke()}}({target:this,width:o,height:i,margin:c,yScale:g,xScale:p,x:s,y:l,title:e[0],points:e[1],line:f})}))}return u.setScales=function({overviewX:e,overviewY:t}){p=e.copy(),p.range([0,o-c.right-c.left]),g=t.copy(),g.range([i-c.top-c.bottom,0]).nice().clamp(!0),f.x((e=>p(+s(e)))).y((e=>g(l(e))))},u.generatePrerenderDetails=function(e){return d=new Map,d},u.render=({data:e,brushGroupSelected:t})=>m({data:e,brushGroupSelected:t}),u}function I({ts:e,element:t,width:r=800,height:o=600,x:a,y:i,groupAttr:s}){let l,c,u,d={};const h=n.select(t).style("display","flex").style("flex-wrap","wrap").style("position","relative").style("top","0px").style("left","0px").style("background-color",e.backgroundColor);let f=n.line().defined((e=>void 0!==i(e)&&null!==i(e))),p=n.line();const g=h.selectAll("canvas").data([1]).join("canvas").attr("height",o*window.devicePixelRatio).attr("width",r*window.devicePixelRatio).style("position","absolute").style("z-index","-1").style("top",`${e.margin.top}px`).style("left",`${e.margin.left}px`).style("width",`${r}px`).style("height",`${o}px`).style("pointer-events","none"),m=g.node().getContext("2d");function b(t,n){return void 0!==n||e.brushesColorScale instanceof Array?e.brushesColorScale[t](n):e.brushesColorScale(t)}function v(t,n,r,o=null){if(t){m.globalAlpha=n*e.alphaScale(t.length);for(let n of t){let t=l.get(n[0]);if(!t)return void console.log("renderOverviewCanvasSubset error finding path",n[0],n);let a=r;if(s){const n=e.colorScale(t.group);a=e.selectedColorTransform(n,o)}m.strokeStyle=""+a,m.stroke(t.path)}}else console.log("ðŸš« Error renderOverviewCanvasSubset called with no dataSubset",t)}return m.scale(window.devicePixelRatio,window.devicePixelRatio),d.data=function(e){l=new Map,e.forEach((e=>{let t=s?s(e[1][0]):null,n={path:new Path2D(f(e[1])),group:t};l.set(e[0],n)}))},d.setScales=function({scaleX:e,scaleY:t}){c=e,u=t,f=f.x((e=>c(+a(e)))).y((e=>u(i(e)))),p=p.x((e=>c(e[0]))).y((e=>u(e[1])))},d.render=function(t,n,r,o,a,i,s){!function(t,n,r,o,a,i=[],s,l){if(r=r||[],m.clearRect(0,0,g.node().width,g.node().height),a){if(m.lineWidth=1,v(r,e.noSelectedAlpha,e.noSelectedColor),t.forEach(((t,r)=>{if(r!==n){let n=b(r,s);console.log("Render selected selectedColor",n,r,s),v(t,e.selectedAlpha,n.toString(),r)}})),v(t.get(n),e.selectedAlpha,b(n,s).toString(),n),l){let t=l.positionTs,n=l.groupId;if(t!==s&&i[t]&&i[t].has(n)){let r=b(n,t);v(i[t].get(n),e.highlightAlpha,r,n)}}m.save(),o&&(m.lineWidth=e.medianLineWidth,m.globalAlpha=e.medianLineAlpha,o.forEach((t=>{if(!t[1])return void console.log("Error drawing medians, empty data",t);let n=new Path2D(p(t[1]));m.setLineDash(e.medianLineDash),m.strokeStyle=X(b(t[0],s)),m.stroke(n)}))),m.restore()}else v(r,e.defaultAlpha,e.defaultColor)}(t,n,r,o,a,i,s)},d}function U(e,t,n){var r,o=n||{},a=o.noTrailing,i=void 0!==a&&a,s=o.noLeading,l=void 0!==s&&s,c=o.debounceMode,u=void 0===c?void 0:c,d=!1,h=0;function f(){r&&clearTimeout(r)}function p(){for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];var s=this,c=Date.now()-h;function p(){h=Date.now(),t.apply(s,o)}function g(){r=void 0}d||(l||!u||r||p(),f(),void 0===u&&c>e?l?(h=Date.now(),i||(r=setTimeout(u?g:p,e))):p():!0!==i&&(r=setTimeout(u?g:p,void 0===u?e-c:e)))}return p.cancel=function(e){var t=(e||{}).upcomingOnly,n=void 0!==t&&t;f(),d=!n},p}function V({data:e,xPartitions:t=10,yPartitions:r=10,polylines:o=!0}){let a={},i=function(){let a=e.map((e=>e[0])),i=e.map((e=>e[1])).flat(),s=n.extent(i,(e=>e[0])),l=n.extent(i,(e=>e[1])),c=s[1]-s[0]+1,u=l[1]-l[0]+1,d=c/t,f=u/r,p={width:c,height:u,xinc:d,yinc:f,offsetX:s[0],offsetY:l[0],keys:a,BVH:[]};for(let e=0;e<t;++e){p.BVH[e]=[];let t=e*d;for(let n=0;n<r;++n){let r=f*n;p.BVH[e][n]={x0:t,x1:t+d,y0:r,y1:r+f,data:new Map}}}e=e.map((([e,t])=>[e,t.map((([e,t])=>[e-p.offsetX,t-p.offsetY]))])),o?function(e,t){let n=t.xinc,r=t.yinc;e.forEach((e=>{let o=e[0],a=-1,i=-1;for(let s=0;s<e[1].length;++s){let l=e[1][s],c=l[0],u=l[1];if(null!=c&&null!=u){let d=Math.floor(c/n),f=Math.floor(u/r);if((isNaN(d)||isNaN(f))&&P("ERROR: xIndex or YIndex is NaN: XCoor: "+c+"; yCoor: "+u),0===s)t.BVH[d][f].data.set(o,[[l]]);else if(d===a&&f===i)t.BVH[d][f].data.get(o).at(-1).push(l);else{let n=t.BVH[a][i];n.data.get(o).at(-1).push(l);let r=e[1][s-1];for(let e of t.BVH)for(let t of e)t!==n&&h([r,l],t.x0,t.y0,t.x1,t.y1)&&(t.data.has(o)?(t.data.get(o).push([r]),t.data.get(o).at(-1).push(l)):(t.data.set(o,[[r]]),t.data.get(o).at(-1).push(l)))}a=d,i=f}}}))}(e,p):function(e,t){let n=t.xinc,r=t.yinc;e.forEach((e=>{let o=e[0];for(let a of e[1]){let[e,i]=a,s=Math.floor(e/n),l=Math.floor(i/r),c=t.BVH[s][l];c.data.has(o)?c.data.get(o).push([e,i]):c.data.set(o,[e,i])}}))}(e,p);return p}();function s(e,t,n,r,o){let[a,i]=e;return a>=t&&a<=r&&i>=n&&i<=o}function l(e,t,n,r,o,a){if(e[0]<=n&&t[0]>=n||e[0]>=n&&t[0]<=n){let o=(t[1]-e[1])/(t[0]-e[0])*(n-e[0])+e[1];return o>=r&&o<=a}return!1}function c(e,t,n,r,o,a){if((e[0]<=o&&t[0])>=o||e[0]>=o&&t[0]<=o){let n=(t[1]-e[1])/(t[0]-e[0])*(o-e[0])+e[1];return n>=r&&n<=a}return!1}function u(e,t,n,r,o,a){if(e[1]<=r&&t[1]>=r||e[1]>=r&&t[1]<=r){let a=(t[1]-e[1])/(t[0]-e[0]),i=(r-e[1])/a+e[0];return i>=n&&i<=o}return!1}function d(e,t,n,r,o,a){if(e[1]>=a&&t[1]<=a||e[1]<=a&&t[1]>=a){let r=(t[1]-e[1])/(t[0]-e[0]),i=(a-e[1])/r+e[0];return i>=n&&i<=o}return!1}function h(e,t,n,r,o){let a=e[0];for(let i=1;i<e.length;++i){let s=e[i];if(l(a,s,t,n,0,o))return!0;if(c(a,s,0,n,r,o))return!0;if(u(a,s,t,n,r))return!0;if(d(a,s,t,0,r,o))return!0;a=s}return s(a,t,n,r,o)}function f(e,t,n,r,o){let a=e[0],i=e[e.length-1],h=!1,f=!1;if(!(a[0]<t&&i[0]<t||a[0]>r&&i[0]>r)){for(let i=1;i<e.length;++i){let s=e[i];if((h||l(a,s,t,n,0,o))&&(h=!0),(f||c(a,s,0,n,r,o))&&(f=!0),u(a,s,t,n,r))return!1;if(d(a,s,t,0,r,o))return!1;a=s}return!(!h&&!f)||s(e[0],t,n,r,o)}}function p(e,t,n,r){return(n>i.width||r>i.height||e<0||t<0)&&P("ðŸ‘ï¸ BVH is called off limits",[[e,t],[n,r]]),n=Math.min(n,i.width-1),r=Math.min(r,i.height-1),e=Math.max(e,0),t=Math.max(t,0),[[Math.floor(e/i.xinc),Math.floor(n/i.xinc)],[Math.floor(t/i.yinc),Math.floor(r/i.yinc)]]}function g(e,t,n,r){return[e-i.offsetX,t-i.offsetY,n-i.offsetX,r-i.offsetY]}return a.contains=function(e,t,n,r){return function(e,t,n,r,o){[e,t,n,r]=g(e,t,n,r);let[[a,s],[l,c]]=p(e,t,n,r),u=new Set,d=new Set;for(let h=a;h<=s;++h)for(let a=l;a<=c;++a)for(const s of i.BVH[h][a].data)if(!d.has(s[0]))for(const a of s[1]){let i=o(a,e,t,n,r);void 0!==i&&(i?u.add(s[0]):d.add(s[0]))}return d.forEach((e=>u.delete(e))),u}(e,t,n,r,f)},a.intersect=function(e,t,n,r){return function(e,t,n,r,o){[e,t,n,r]=g(e,t,n,r);let[[a,s],[l,c]]=p(e,t,n,r),u=new Set;for(let d=a;d<=s;++d)for(let a=l;a<=c;++a)for(const s of i.BVH[d][a].data)if(!u.has(s[0]))for(const a of s[1])if(o(a,e,t,n,r)){u.add(s[0]);break}return u}(e,t,n,r,h)},a}function q(e){const t=document.createElement("template");return t.innerHTML=e,document.importNode(t.content,!0)}function Q(e){const t=document.createElementNS("http://www.w3.org/2000/svg","g");return t.innerHTML=e,t}const K=Object.assign(ye(q,(e=>{if(null===e.firstChild)return null;if(e.firstChild===e.lastChild)return e.removeChild(e.firstChild);const t=document.createElement("span");return t.appendChild(e),t})),{fragment:ye(q,(e=>e))});Object.assign(ye(Q,(e=>null===e.firstChild?null:e.firstChild===e.lastChild?e.removeChild(e.firstChild):e)),{fragment:ye(Q,(e=>{const t=document.createDocumentFragment();for(;e.firstChild;)t.appendChild(e.firstChild);return t}))});const Z=60,J=62,ee=47,te=45,ne=33,re=61,oe=10,ae=11,ie=12,se=13,le=14,ce=17,ue=22,de=23,he=26,fe="http://www.w3.org/2000/svg",pe="http://www.w3.org/1999/xlink",ge="http://www.w3.org/XML/1998/namespace",me="http://www.w3.org/2000/xmlns/",be=new Map(["attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map((e=>[e.toLowerCase(),e]))),ve=new Map([["xlink:actuate",pe],["xlink:arcrole",pe],["xlink:href",pe],["xlink:role",pe],["xlink:show",pe],["xlink:title",pe],["xlink:type",pe],["xml:lang",ge],["xml:space",ge],["xmlns",me],["xmlns:xlink",me]]);function ye(e,t){return function({raw:n}){let r,o,a,i,s=1,l="",c=0;for(let e=0,t=arguments.length;e<t;++e){const t=n[e];if(e>0){const r=arguments[e];switch(s){case he:if(null!=r){const e=`${r}`;if(Ae(o))l+=e.replace(/[<]/g,xe);else{if(new RegExp(`</${o}[\\s>/]`,"i").test(l.slice(-o.length-2)+e))throw new Error("unsafe raw text");l+=e}}break;case 1:null==r||(r instanceof Node||"string"!=typeof r&&r[Symbol.iterator]||/(?:^|>)$/.test(n[e-1])&&/^(?:<|$)/.test(t)?(l+="\x3c!--::"+e+"--\x3e",c|=128):l+=`${r}`.replace(/[<&]/g,xe));break;case 9:{let o;if(s=ie,/^[\s>]/.test(t)){if(null==r||!1===r){l=l.slice(0,a-n[e-1].length);break}if(!0===r||""==(o=`${r}`)){l+="''";break}if("style"===n[e-1].slice(a,i)&&ke(r)||"function"==typeof r){l+="::"+e,c|=1;break}}if(void 0===o&&(o=`${r}`),""===o)throw new Error("unsafe unquoted empty string");l+=o.replace(/^['"]|[\s>&]/g,xe);break}case ie:l+=`${r}`.replace(/[\s>&]/g,xe);break;case ae:l+=`${r}`.replace(/['&]/g,xe);break;case oe:l+=`${r}`.replace(/["&]/g,xe);break;case 6:if(ke(r)){l+="::"+e+"=''",c|=1;break}throw new Error("invalid binding");case ce:break;default:throw new Error("invalid binding")}}for(let e=0,n=t.length;e<n;++e){const n=t.charCodeAt(e);switch(s){case 1:n===Z&&(s=2);break;case 2:n===ne?s=25:n===ee?s=3:we(n)?(r=e,o=void 0,s=4,--e):63===n?(s=5,--e):(s=1,--e);break;case 3:we(n)?(s=4,--e):n===J?s=1:(s=5,--e);break;case 4:Se(n)?(s=6,o=Ce(t,r,e)):n===ee?s=le:n===J&&(o=Ce(t,r,e),s=Be(o)?he:1);break;case 6:Se(n)||(n===ee||n===J?(s=7,--e):n===re?(s=8,a=e+1,i=void 0):(s=8,--e,a=e+1,i=void 0));break;case 8:Se(n)||n===ee||n===J?(s=7,--e,i=e):n===re&&(s=9,i=e);break;case 7:Se(n)||(n===ee?s=le:n===re?s=9:n===J?s=Be(o)?he:1:(s=8,--e,a=e+1,i=void 0));break;case 9:Se(n)||(34===n?s=oe:39===n?s=ae:n===J?s=Be(o)?he:1:(s=ie,--e));break;case oe:34===n&&(s=se);break;case ae:39===n&&(s=se);break;case ie:Se(n)?s=6:n===J&&(s=Be(o)?he:1);break;case se:Se(n)?s=6:n===ee?s=le:n===J?s=Be(o)?he:1:(s=6,--e);break;case le:n===J?s=1:(s=6,--e);break;case 5:n===J&&(s=1);break;case 15:n===te?s=16:n===J?s=1:(s=ce,--e);break;case 16:n===te?s=de:n===J?s=1:(s=ce,--e);break;case ce:n===Z?s=18:n===te&&(s=ue);break;case 18:n===ne?s=19:n!==Z&&(s=ce,--e);break;case 19:n===te?s=20:(s=ce,--e);break;case 20:n===te?s=21:(s=de,--e);break;case 21:s=de,--e;break;case ue:n===te?s=de:(s=ce,--e);break;case de:n===J?s=1:n===ne?s=24:n!==te&&(s=ce,--e);break;case 24:n===te?s=ue:n===J?s=1:(s=ce,--e);break;case 25:n===te&&t.charCodeAt(e+1)===te?(s=15,++e):(s=5,--e);break;case he:n===Z&&(s=27);break;case 27:n===ee?s=28:(s=he,--e);break;case 28:we(n)?(r=e,s=29,--e):(s=he,--e);break;case 29:Se(n)&&o===Ce(t,r,e)?s=6:n===ee&&o===Ce(t,r,e)?s=le:n===J&&o===Ce(t,r,e)?s=1:we(n)||(s=he,--e);break;default:s=void 0}}l+=t}const u=e(l),d=document.createTreeWalker(u,c,null,!1),h=[];for(;d.nextNode();){const e=d.currentNode;switch(e.nodeType){case 1:{const t=e.attributes;for(let n=0,r=t.length;n<r;++n){const{name:o,value:a}=t[n];if(/^::/.test(o)){const t=arguments[+o.slice(2)];_e(e,o),--n,--r;for(const n in t){const r=t[n];null==r||!1===r||("function"==typeof r?e[n]=r:"style"===n&&ke(r)?Ee(e[n],r):Me(e,n,!0===r?"":r))}}else if(/^::/.test(a)){const t=arguments[+a.slice(2)];_e(e,o),--n,--r,"function"==typeof t?e[o]=t:Ee(e[o],t)}}break}case 8:if(/^::/.test(e.data)){const t=e.parentNode,n=arguments[+e.data.slice(2)];if(n instanceof Node)t.insertBefore(n,e);else if("string"!=typeof n&&n[Symbol.iterator])if(n instanceof NodeList||n instanceof HTMLCollection)for(let r=n.length-1,o=e;r>=0;--r)o=t.insertBefore(n[r],o);else for(const r of n)null!=r&&t.insertBefore(r instanceof Node?r:document.createTextNode(r),e);else t.insertBefore(document.createTextNode(n),e);h.push(e)}}}for(const e of h)e.parentNode.removeChild(e);return t(u)}}function xe(e){return`&#${e.charCodeAt(0).toString()};`}function we(e){return 65<=e&&e<=90||97<=e&&e<=122}function Se(e){return 9===e||10===e||12===e||32===e||13===e}function ke(e){return e&&e.toString===Object.prototype.toString}function Be(e){return"script"===e||"style"===e||Ae(e)}function Ae(e){return"textarea"===e||"title"===e}function Ce(e,t,n){return e.slice(t,n).toLowerCase()}function Me(e,t,n){e.namespaceURI===fe&&(t=t.toLowerCase(),t=be.get(t)||t,ve.has(t))?e.setAttributeNS(ve.get(t),t,n):e.setAttribute(t,n)}function _e(e,t){e.namespaceURI===fe&&(t=t.toLowerCase(),t=be.get(t)||t,ve.has(t))?e.removeAttributeNS(ve.get(t),t):e.removeAttribute(t)}function Ee(e,t){for(const n in t){const r=t[n];n.startsWith("--")?e.setProperty(n,r):e[n]=r}}function Ge({fmtX:e,fmtY:t,target:n,margin:r={top:0,left:0},callback:o=(()=>{})}){const a=K`<input class="x0" contenteditable="true"></input>`,i=K`<input class="y0" contenteditable="true"></input>`,s=K`<input class="x1" contenteditable="true"></input>`,l=K`<input class="y1" contenteditable="true"></input>`,c=e=>{function t(){this.style.width=this.value.length+1+"ch"}e.addEventListener("input",t),t.call(e)},u=()=>[a,i,s,l].map(c),d=K`<button>âœ…</button>`,h=K`<button>âœ…</button>`,f=K`<div style="position: absolute; top:0; left:0;">
    <div style="display:flex; position: absolute; bottom: 0px; right: 0px;">
      ${a}<strong> x </strong>${i} ${d}
    </div>
  </div>`,p=K`<div style="position: absolute; display:flex;">${s}<strong> x </strong>${l} ${h}</div>`,g=K`<div class="__ts_tooltip" style="display: none; z-index:2; position: absolute; top: ${r.top}px; left: ${r.left}px;">
    <style>
    div.__ts_tooltip { 
      font-family: sans-serif; font-size: 10pt; 
    }
    div.__ts_tooltip > div > div * { 
      margin-right: 1px;
    }
    div.__ts_tooltip div > button {
      padding: 0px;
      display: none;
    }
    div.__ts_tooltip div:hover > button {
      padding: 0px;
      display: block;
    }
    div.__ts_tooltip input {
      background-color:rgba(255, 255, 255, 0);    
      border: none;
      outline: none;
    }
    div.__ts_tooltip input:focus {
        border: solid #aaa;
    }


    </style>
    <div>${f}</div>
    <div>${p}</div>

  </div>`;function m(){g.value=[[a.value,i.value],[s.value,l.value]],g.dispatchEvent(new Event("input",{bubbles:!0})),o(g.value)}g.__update=({selection:n,selectionPixels:r})=>{g.style.display="block",a.value=e(n[0][0]),s.value=e(n[1][0]),i.value=t(n[0][1]),l.value=t(n[1][1]),u(),f.style.top=r[0][1]+"px",f.style.left=r[0][0]+"px",p.style.top=r[1][1]+"px",p.style.left=r[1][0]+"px"},g.__hide=()=>g.style.display="none",d.addEventListener("click",m),h.addEventListener("click",m);let b=n.getElementsByClassName("__ts_tooltip");return b.length>0&&n.removeChild(b[0]),n.appendChild(g),u(),g}function Te({target:e,callback:t}){const n=K`<input type="radio" name="mode" id="__ts_c_intersect" value="intersect">`,r=K`<input type="radio" name="mode" id="__ts_c_contains" value="contains">`,o=K`<input type="checkbox"  id="__ts_c_not">`,a=K`<input type="radio" name="aggregation" id="__ts_c_and" value="and">`,i=K`<input type="radio" name="aggregation" id="__ts_c_or" value="or">`,s=K`<button style="position: absolute; right: 0; top: 0; padding: 0; margin: 0; border: none; background: none; cursor: pointer; font-size: 0.8rem; color: #444; line-height: 1; padding: 2px 2px;">&times;</button>`;let l;n.onchange=d,r.onchange=d,a.onchange=d,i.onchange=d,o.onchange=d;let c=K`<div class="__ts_contextMenu" style="display: none; z-index: 2; position: absolute" >
        ${s}
      
        <div class="__ts_option_label"><strong>Mode</strong></div>
        <div class="__ts_option_values">
          <div>
            ${n}
            <label for="__ts_c_intersect" title="Search for timelines that touch any part of the timebox">Intersect</label>
          </div>
          <div>
            ${r}
            <label for="__ts_c_contains" title="Search for timelines that are fully contained in the timebox">Contains</label>
          </div>
          <div>
            ${o}
            <label for="__ts_c_not" title=" ">Not</label>
          </div>
        </div>
      

      
        <div class="__ts_option_label"><strong>Aggregation</strong></div>
        <div class="__ts_option_values">
          <div>
            ${a}
            <label for="__ts_c_and">And</label>
          </div>
          <div>
            ${i}
            <label for="__ts_c_or">Or</label>
          </div>
        </div>
      
      

      <style> 
        .__ts_contextMenu { 
            border-radius: 3px;
            padding: 4px 14px 4px 4px;
            position: absolute; 
            width: max-content;
            background: #f6f6f6;
            opacity: 0.9;
            border: 1px solid #ccc; 
            font-family: sans-serif;
            font-size: 0.8rem;
            grid-template-columns: 1fr auto;
            grid-row-gap: 7px;
            box-shadow: 2px 2px 1px 0px #888888;
        }         

        .__ts_contextMenu  .__ts_option_values:hover { 
            background: #eee; 
        } 

        .__ts_contextMenu input[type="radio"] {
          margin-top: -1px;
          vertical-align: middle;
        }
      </style> 
    </div>`;e.appendChild(c);let u=null;function d(){let e=n.checked?H.Intersect:H.Contains,r=a.checked?F.And:F.Or,i=o.checked;t(e,r,i,l)}return c.onmouseleave=()=>u=setTimeout((()=>{c.__hide(),u=null}),1e3),c.onmouseenter=()=>{u&&clearTimeout(u),u=null},s.onclick=()=>c.__hide(),c.__hide=()=>c.style.display="none",c.__show=(e,t,s,u,d,h)=>{switch(l=h,e){case H.Intersect:n.checked=!0;break;case H.Contains:r.checked=!0;break;default:n.checked=!0,P("ðŸš« ERROR The method elected to compute the selection are not support")}switch(o.checked=s,t){case F.And:a.checked=!0;break;case F.Or:i.checked=!0;break;default:a.checked=!0,P("ðŸš« ERROR The aggregation method elected are not support")}c.style.display="grid",c.style.left=u+"px",c.style.top=d+"px"},c}return function(e,{target:t=document.createElement("div"),showBrushesControls:r=!0,showBrushTooltip:o=!0,showBrushesCoordinates:a=!0,showDetails:i=!0,x:s=(e=>e.x),y:l=(e=>e.y),id:c=(e=>e.id),color:d=null,referenceCurves:h=null,fmtX:f,fmtY:p=n.format(".1f"),stepX:g={days:10},stepY:m=1,xScale:b,yScale:v=n.scaleLinear(),xDomain:y,yDomain:x,yLabel:w="",xLabel:S="",xTicks:k,yTicks:B,filters:A=[],defaultAlpha:C=.7,selectedAlpha:M=1,noSelectedAlpha:_=.1,alphaScale:E=n.scalePow().exponent(.25).range([1,1]),backgroundColor:G="#ffffff",defaultColor:T="#aaa",selectedColor:N="#aaa",noSelectedColor:$="#dce0e5",colorScale:Y=n.scaleOrdinal(n.schemeAccent),brushesColorScale:L=(d?n.scaleOrdinal(n.schemeGreys[3].toReversed()):n.scaleOrdinal(n.schemeTableau10)),selectedColorTransform:q=((e,t)=>n.color(e).darker(t)),width:Q=800,detailsWidth:K=400,height:Z=600,detailsHeight:J=300,detailsContainerHeight:ee=400,margin:te={left:50,top:30,bottom:50,right:50},detailsMargin:ne=null,updateCallback:re=(()=>{}),statusCallback:oe=(()=>{}),brushShadow:ae="drop-shadow( 2px 2px 2px rgba(0, 0, 0, .7))",showGroupMedian:ie=!0,hasDetails:se=!1,doubleYlegend:le=!1,showGrid:ce=!1,brushGroupSize:ue=15,maxDetailsRecords:de=10,maxTimelines:he=null,xPartitions:fe=10,yPartitions:pe=10,medianNumBins:ge=10,medianLineDash:me=[7],medianLineAlpha:be=1,medianLineWidth:ve=2,medianFn:ye=n.median,medianMinRecordsPerBin:xe=5,autoUpdate:we=!0,_this:Se,fixAxis:ke,groupAttr:Be=null,overviewWidth:Ae,overviewHeight:Ce,tsParent:Me,highlightAlpha:_e=1}={}){Q=Ae||Q,Z=Ce||Z,ne=ne||te;let Ee,De,Ne,$e,Ye,Re,Le,Pe,Xe,je,Oe,ze,He,Fe,We,Ie,Ue,Ve,qe,Qe,Ke,Ze,Je,et,tt,nt,rt,ot,at,it,st={},lt=null;if(st.xPartitions=fe,st.yPartitions=pe,st.defaultAlpha=C,st.selectedAlpha=M,st.noSelectedAlpha=_,st.backgroundColor=G,st.defaultColor=T,st.selectedColor=N,st.noSelectedColor=$,st.hasDetails=se,st.margin=te,st.colorScale=Y,st.brushesColorScale=L,st.color=d,st.doubleYlegend=le,st.showGrid=ce,st.showBrushTooltip=o,st.autoUpdate=we,st.brushGroupSize=ue,st.stepX=g,st.stepY=m,st.medianLineAlpha=be,st.medianLineWidth=ve,st.medianLineDash=me,st.medianNumBins=ge,st.medianFn=ye,st.alphaScale=E,st.medianMinRecordsPerBin=xe,st.yScale=v,st.xScale=b,st.highlightAlpha=_e,st.selectedColorTransform=q,Be&&(console.warn('The attribute "groupAttr" is deprecated use "color" instead'),d=Be),"string"==typeof s){let e=s;s=t=>t[e]}if("string"==typeof l){let e=l;l=t=>t[e]}if("string"==typeof c){let e=c;c=t=>t[e]}if(d&&"string"==typeof d){let e=d;d=t=>t[e]}function ct(e){return void 0!==ot||st.brushesColorScale instanceof Array?st.brushesColorScale[e](ot):st.brushesColorScale(e)}function ut(){if(it.addBrushGroup(),nt){Bt(new CustomEvent("TimeWidget",{detail:{type:z.addBrushGroup}}))}}function dt(e){if(it.selectBrushGroup(e),nt){Bt(new CustomEvent("TimeWidget",{detail:{type:z.selectBrushGroup,data:e}}))}}function ht(e){if(nt){if(e){Bt(new CustomEvent("TimeWidget",{detail:{type:z.deselectAllBrushes}}))}let t;t=e?new CustomEvent("TimeWidget",{detail:{type:z.highlightSelection,data:{positionTs:ot,groupId:e[1].group}}}):new CustomEvent("TimeWidget",{detail:{type:z.highlightSelection}}),Bt(t)}}function ft(){n.select(Oe).select("#brushesList").selectAll(".brushControl").data(it.getBrushesGroup(),(e=>e[0])).join("div").attr("class","brushControl").each((function(e,t,r){let o=r.length;const a=n.select(this);let i=e[1].name,s=qe.has(e[0])?qe.get(e[0]).length:0;a.node().innerHTML=`<div style="\n            display: flex;\n            flex-wrap: nowrap;\n            align-items: center;\n          ">\n            <input type="checkbox" id="checkBoxShowBrushGroup" ${e[1].isEnable?"checked":""} ></input>\n            <div\n              id="groupColor"\n              style="\n              min-width: ${st.brushGroupSize}px;\n              width: ${st.brushGroupSize}px;\n              height: ${st.brushGroupSize}px;\n              background-color: ${ct(e[0])};\n              border-width: ${e[0]===it.getBrushGroupSelected()?2:0}px;\n              border-color: black;\n              border-style: solid;\n              margin-right: 5px;\n              cursor: pointer;\n            "></div>\n            <input\n              id="groupName"\n              style="margin-right: 5px; border: none;outline: none; width: ${i.length}ch;"\n              contenteditable="true"\n              value="${i}"></input>\n            <span id="groupSize" style="margin-right: 5px;">(${s})</span>\n           <button style="color: red;font-weight: bold; border:none; background:none;\n            display:${o>1?"block":"none"}" id="btnRemoveBrushGroup">&cross;</button>\n          </div>\n        `,a.select("input#groupName").on("input",(function(e){n.select(this).style("width",e.target.value.length+"ch")})),a.select("input#groupName").on("change",(t=>{n.select(this).style("width",t.target.value.length+"ch"),it.updateBrushGroupName(e[0],t.target.value),St()})),a.select("#btnRemoveBrushGroup").on("click",(t=>{t.stopPropagation(),function(e){it.removeBrushGroup(e),nt&&Bt(new CustomEvent("TimeWidget",{detail:{type:z.removeBrushGroup,data:e}}))}(e[0])})),a.select("#checkBoxShowBrushGroup").on("click",(e=>{e.stopPropagation()})),a.select("#checkBoxShowBrushGroup").on("change",(t=>{t.stopPropagation(),function(e,t){it.changeBrushGroupState(e,t),nt&&Bt(new CustomEvent("TimeWidget",{detail:{type:z.changeBrushGroupState,data:{id:e,newState:t}}}))}(e[0],t.target.checked),console.log("Should change state of brushesGroup "+e[0],t.target.checked)})),a.select("div#groupColor").on("click",(()=>dt(e[0]))),a.select("span#groupSize").on("click",(()=>dt(e[0])))})),n.select(Oe).select("#brushesList").selectAll(".nonSelectedControl").remove(),n.select(Oe).select("#brushesList").append("div").attr("class","nonSelectedControl").each((function(){const e=n.select(this);let t="Non selected",r=Qe.length;e.node().innerHTML=`<div style="\n            display: flex;\n            flex-wrap: nowrap;\n            align-items: center;\n            margin-bottom: 5px;\n          ">\n            <input type="checkbox" id="checkBoxShowBrushGroup" ${Ke?"checked":""} ></input>\n            <output\n              style="margin-right: 0; border: none;outline: none; width: ${t.length}ch;"\n              >${t}</output>\n            <span id="groupSize" style="margin-right: 5px;">(${r})</span>\n          </div>\n        `,e.select("#checkBoxShowBrushGroup").on("change",(e=>{var t;e.stopPropagation(),t=e.target.checked,Ke=t,nt&&Bt(new CustomEvent("TimeWidget",{detail:{type:z.changeNonSelected,data:{newState:t}}})),yt()}))})),He.selectAll(".colorBrushes").data(it.getBrushesGroup(),(e=>e[0])).join("rect").attr("class","colorBrushes").attr("id",(e=>"colorBrush-"+e[0])).attr("height",st.brushGroupSize).attr("width",st.brushGroupSize).attr("transform",((e,t)=>`translate(${90+t*(st.brushGroupSize+5)}, -2)`)).style("stroke-width",(e=>e[0]===it.getBrushGroupSelected()?2:0)).style("stroke","black").style("fill",(e=>ct(e[0]))).on("click",(function(){dt(+n.select(this).attr("id").substr("11"))}))}function pt(){Pe=n.select(Le).selectAll("div#divData").data([1]).join("div").attr("id","divData"),Re=n.select(Ye).selectAll("div#render").data([1]).join("div").attr("id","render").style("position","relative").style("z-index",1),tt=I({ts:st,element:Re.node(),width:Q,height:Z,x:s,y:l,groupAttr:d,overviewX:Ne,overviewY:$e}),ze=Re.selectAll("svg").data([1]).join("svg").attr("viewBox",[0,0,Q,Z]).attr("height",Z).attr("width",Q);const e=ze.selectAll("g.gDrawing").data([1]).join("g").attr("class","gDrawing").attr("transform",`translate(${st.margin.left}, ${st.margin.top})`).attr("tabindex",0).style("pointer-events","all").style("outline","-webkit-focus-ring-color solid 0px").on("keydown",(e=>{switch(e.preventDefault(),e.key){case"r":case"Backspace":case"Delete":it.removeSelectedBrush();break;case"+":ut();break;case"ArrowRight":!function(){let e=it.getSelectedBrush();if(null===e)return;let[[t,n],[r,o]]=e[1].selectionDomain,a=Ne.domain()[1];if(Je)if(r=u(r,st.stepX),r>a){r=R(r,st.stepX);let e=D({start:r,end:a});r=a,t=u(t,e)}else t=u(t,st.stepX);else if(r+=st.stepX,r>a){let e=a-r+st.stepX;r=a,t-=e}else t+=st.stepX;it.moveSelectedBrush([[t,n],[r,o]],!0)}();break;case"ArrowLeft":!function(){let e=it.getSelectedBrush();if(null===e)return;let[[t,n],[r,o]]=e[1].selectionDomain,a=Ne.domain()[0];if(Je)if(t=R(t,st.stepX),t<a){t=u(t,st.stepX);let e=D({start:a,end:t});t=a,r=R(r,e)}else r=R(r,st.stepX);else if(t-=st.stepX,t<a){let e=t+st.stepX-a;t=a,r-=e}else r-=st.stepX;it.moveSelectedBrush([[t,n],[r,o]],!0)}();break;case"ArrowUp":!function(){let e=it.getSelectedBrush();if(null===e)return;let[[t,n],[r,o]]=e[1].selectionDomain;n+=st.stepY;let a=$e.domain()[1];if(n>a){let e=a-n+st.stepY;n=a,o+=e}else o+=st.stepY;it.moveSelectedBrush([[t,n],[r,o]],!0)}();break;case"ArrowDown":!function(){let e=it.getSelectedBrush();if(null===e)return;let[[t,n],[r,o]]=e[1].selectionDomain;o-=st.stepY;let a=$e.domain()[0];if(o<a){let e=o+st.stepY-a;o=a,n-=e}else n-=st.stepY;it.moveSelectedBrush([[t,n],[r,o]],!0)}();break;case"i":it.invertQuerySelectedGroup()}}));let t=n.axisLeft($e);B&&t.tickValues(B.map((e=>e[0]))).tickFormat(((e,t)=>B[t][1]?B[t][1]:B[t][0]));let o=e.selectAll("g.mainYAxis").data([1]).join("g").attr("class","mainYAxis").call(t).call((e=>e.selectAll("text.label").data([1]).join("text").text(w).attr("dy",-15).attr("class","label").style("fill","black").style("text-anchor","end").style("pointer-events","none"))).style("pointer-events","none");st.doubleYlegend&&e.selectAll("g.secondYaxis").data([1]).join("g").attr("class","secondYaxis").call(n.axisRight($e)).attr("transform",`translate(${Q-st.margin.left-st.margin.right},0)`).style("pointer-events","none");let i=n.axisBottom(Ne||e);k&&i.tickValues(k.map((e=>e[0]))).tickFormat(((e,t)=>k[t][1]?k[t][1]:k[t][0]));let c=e.selectAll("g.mainXAxis").data([1]).join("g").attr("class","mainXAxis").call(i).attr("transform",`translate(0, ${Z-st.margin.top-st.margin.bottom})`).call((e=>e.selectAll("text.label").data([1]).join("text").attr("class","label").text(S).attr("transform",`translate(${Q-st.margin.right-st.margin.left-5}, -10 )`).style("fill","black").style("text-anchor","end").style("pointer-events","none"))).style("pointer-events","none");return We=e.selectAll("g.gReferences").data([1]).join("g").attr("class","gReferences").style("pointer-events","none"),o.selectAll("g.tick").selectAll(".gridline").data(st.showGrid?[1]:[]).join("line").attr("class","gridline").attr("x1",0).attr("y1",0).attr("x2",Q-st.margin.right-st.margin.left).attr("y2",0).attr("stroke","#9ca5aecf").attr("stroke-dasharray","4"),c.selectAll("g.tick").selectAll(".gridline").data(st.showGrid?[1]:[]).join("line").attr("class","gridline").attr("x1",0).attr("y1",-Z+st.margin.top+st.margin.bottom).attr("x2",0).attr("y2",0).attr("stroke","#9ca5aecf").attr("stroke-dasharray","4"),d&&(De.forEach((e=>Ze.add(d(e)))),Ze.size),He=ze.selectAll("g.colorBrushes").data([1]).join("g").attr("class","colorBrushes").attr("transform",`translate(${st.margin.left+10},${st.margin.top-st.brushGroupSize-5} )`),Fe=e.selectAll("g#brushes").data([1]).join("g").attr("id","brushes"),it=function({ts:e,data:t,element:r,tooltipTarget:o,contextMenuTarget:a,xPartitions:i,yPartitions:s,x:l,y:c,scaleX:u,scaleY:d,fmtX:h,fmtY:f,updateTime:p,brushShadow:g,minBrushSize:m=5,tsLevel:b,selectionCallback:v=(()=>{}),groupsCallback:y=(()=>{}),changeSelectedCoordinatesCallback:x=(()=>{}),selectedBrushCallback:w=(()=>{}),statusCallback:S=(()=>{})}){let k,B,A,C,M,_,E,G,T,D,N,$,Y,R,L,z={},W=0;if(!t)return;A=n.select(r),A.node().innerHTML="",C=U(p,te),M=U(p,le),_=U(50,be),E=U(50,ie),D=new Map,N=[],B=new Map,W=0,k=0;let I=t.map((e=>{let t=e[1].map((e=>[u(l(e)),d(c(e))]));return[e[0],t]}));function q([[e,t],[r,o]]){if(t=+t,o=+o,isNaN(+e)){let t=n.timeParse(h);e=t(e),r=t(r)}else e=+e,r=+r;z.moveBrush(L,[[e,t],[r,o]])}function Q(e,t,n,r){r[1].mode=e,r[1].aggregation=t,r[1].negate=n,de(r),ne()}$=V({data:I,xPartitions:i,yPartitions:s}),Y=Ge({fmtX:h,fmtY:f,target:o,margin:{top:e.margin.top,left:e.margin.left},callback:q}),R=Te({target:a,callback:Q});const K=(t,n)=>{if(P("ðŸ’¡  onBrushStart",n,arguments.length),!n||!n.length)return void P("ðŸš« ERRROR onBrushStart called with no or wrong brush",n);const[r,o]=n;r===W-1&&(k++,we([r,o],G),B.get(G).isEnable=!0,T=[r,o],w(T),Se()),e.autoUpdate&&C(t,[r,o])};function Z({selection:t,sourceEvent:n},r){if(void 0!==n){if(t){let[[o,a],[i,s]]=t;Math.abs(o-i)<m&&Math.abs(a-s)<m?re(r):e.autoUpdate||(r[1].isSelected?le():te({selection:t,sourceEvent:n},r))}else re(r);r[0]===W-1&&J(),Se()}}function J(t=H.Intersect,r=F.And,o=G,a){let i=n.brush().on("start",K);B.get(o).brushes.set(W,ke(i,t,r,o,null,null,a));let s=[W,B.get(G).brushes.get(W)];i.on("brush.move",ue),i.on("brush.Selected",E),e.autoUpdate&&i.on("brush.brushed",C),e.showBrushTooltip&&i.on("brush.show",(e=>_(e,s))),i.on("end",Z),W++}function ee(e){return e.map((([e,t])=>[u.invert(e),d.invert(t)]))}function te({selection:e,sourceEvent:t},n){n[1]?void 0!==t&&e&&(n[1].selection=e,n[1].selectionDomain=ee(e),de(n)&&ne()):P("**ðŸš« ERROR brushed called without a brush[1]",n)}function ne(){if(N=[],D=new Map,B.forEach(((e,t)=>D.set(t,[]))),k>0)for(let e of t){let t=!1;for(let[n,r]of B.entries())se(e,r.brushes)&&(D.get(n).push(e),t=!0);t||N.push(e)}else N=t;v(D,N,0!==k)}function re([e,t]){k--,B.get(t.group).brushes.delete(e),Se(),ne(),oe(),Y.__hide()}function oe(){S()}function ae(){y(B)}function ie({selection:e}){let t=ee(e);x(t)}function se(e,t){if(0===t.size)return!1;if(1===t.size&&!t.values().next().value.intersections)return!1;let n=!0,r=!1;for(const o of t.values())if(o.intersections)switch(o.aggregation){case F.And:n=n&&o.intersections.has(e[0]),r=!0;break;case F.Or:if(o.intersections.has(e[0]))return!0}return n&&r}function le(){let e=!1;for(const t of B.values())for(const n of t.brushes)if(n[1].isSelected){let t=de(n);e=e||t}e&&ne()}function ce([e,t],n,r){let[[o,a],[i,s]]=t.selection;o+=n,i+=n,a+=r,s+=r,A.selectAll("#brush-"+e).call(t.brush.move,[[o,a],[i,s]]),t.selection=[[o,a],[i,s]],t.selectionDomain=ee(t.selection)}function ue({selection:t,sourceEvent:n},r){if(void 0===n)return;if(!Array.isArray(r)||2!==r.length)return void P("ðŸ‘ï¸ moveSelectedBrushes called without array trigger returning",r);const[o,a]=r;if(!t||!a.isSelected)return;let[[i,s]]=t,l=i-a.selection[0][0],c=s-a.selection[0][1];a.selection=t,a.selectionDomain=ee(t);for(const e of B.values())for(const[t,n]of e.brushes)n.isSelected&&o!==t&&ce([t,n],l,c);e.autoUpdate&&M()}function de([e,n]){let[[r,o],[a,i]]=n.selection,s=null;switch(n.mode){case H.Intersect:s=$.intersect(r,o,a,i);break;case H.Contains:s=$.contains(r,o,a,i);break;default:s=$.intersect(r,o,a,i),P("ðŸš« ERROR The method elected to compute the selection are not support, using default intersection instead ")}if(n.negate){let e=new Set(t.map((e=>e[0])));for(const t of s)e.delete(t);s=e}he();let l=!j(s,n.intersections);return n.intersections=s,l}function he(){A.selectAll(".brush").each((function([,e]){n.select(this).selectAll(".handle--w, .handle--e").style("fill",e.mode===H.Contains?X(xe(e.group)):"none").style("opacity",.4),n.select(this).selectAll(".handle--n, .handle--s").style("fill",e.negate?"red":"none").style("opacity",.4),n.select(this).selectAll("title").data([0]).join("title").text(`Mode: ${e.mode===H.Contains?"Contains":"Intersect"}\nAggregation: ${e.aggregation===F.And?"And":"Or"}\nRight click for options`)}))}function fe(e){e[1].isSelected=!e[1].isSelected,ae(),w(e)}function pe(){for(let e of B.values())for(let t of e.brushes)t[1].isSelected=!1}function ge(){let e=Array.from(B.keys()).sort(),t=-1;for(let n of e){if(t+1!==n)break;t++}return t++,t}function me(e){return T&&e[0]===T[0]?g:""}function be({selection:e,sourceEvent:t},n){if(!e||void 0===t)return;let r=e.map((([e,t])=>[u.invert(+e),d.invert(+t)]));L=n,Y.__update({selection:r,selectionPixels:e})}function ve(t){const r=t[1];n.select(this).selectAll(".selection").style("outline","-webkit-focus-ring-color solid 0px").style("fill",xe(r.group)).style("stroke-width",r.group===G?"2px":"0.5px").style("stroke-dasharray",r.isSelected?"4":"").style("stroke",X(xe(r.group))).style("outline-color",X(xe(r.group))).style("fill",xe(r.group)).attr("tabindex",0).on("mousedown",(e=>{0===e.button&&(ie({selection:r.selection}),T=T&&t[0]===T[0]?null:t,w(T),A.selectAll(".brush").style("-webkit-filter",me).style("filter",me),e.shiftKey&&fe(t))})).on("contextmenu",(e=>{e.preventDefault();let n=r.selection[0][0],o=r.selection[0][1];R.__show(r.mode,r.aggregation,r.negate,n,o,t)})),e.showBrushTooltip&&n.select(this).selectAll(":not(.overlay)").on("mousemove",(e=>{be({selection:r.selection,sourceEvent:e},t)}))}function ye(e){G!==e&&(B.get(G).isActive=!1,pe(),B.get(),G=e,B.get(e).isActive=!0,B.get(e).isEnable=!0,Se())}function xe(t){return void 0!==b||e.brushesColorScale instanceof Array?e.brushesColorScale[t](b):e.brushesColorScale(t)}function we([e,t],n){B.get(t.group).brushes.delete(e),t.group=n,B.get(n).brushes.set(e,t)}function Se(){let e=[];B.forEach((t=>e=e.concat(Array.from(t.brushes)))),e.sort(((e,t)=>n.descending(e[0],t[0])));const t=A.selectAll(".brush").data(e,(e=>e[0])).join("g").attr("class","brush").attr("id",(([e])=>"brush-"+e)).each((function([,e]){return n.select(this).call(e.brush)})).style("-webkit-filter",me).style("filter",me).style("display",(e=>B.get(e[1].group).isEnable?"":"none")).style("pointer-events",(e=>e[1].group===G?"all":"none")).each(ve);t.each((function(e){n.select(this).selectAll(".overlay").style("pointer-events",(()=>W-1===e[0]?"all":"none"))})),t.each((function([e,t]){t.initialSelection&&(P("ðŸŽ‰ setting initial selection",t.initialSelection),n.select(this).selectAll(".selection").style("stroke",X(xe(t.group))).style("outline-color",X(xe(t.group))).style("fill",xe(t.group)),z.moveBrush([e,t],t.initialSelection),t.initialSelection=void 0)}))}function ke(e,t,n,r,o,a,i){return{brush:e,intersections:null,mode:t,aggregation:n,negate:!1,isSelected:!1,group:r,selection:o,selectionDomain:a,initialSelection:i}}z.updateBrushGroupName=function(e,t){B.get(e).name=t,ae(),oe()},z.addBrushGroup=function(){if(void 0!==b&&B.size===e.brushesColorScale.length)return void P("Another group cannot be added because there is no defined color family. ");let t=ge(),n={isEnable:!0,isActive:!1,name:"Group "+(t+1),brushes:new Map};B.set(t,n),D.set(t,[]),ye(t),v(D,N,0!==k),oe(),ae()},z.changeBrushGroupState=function(e,t){B.get(e).isEnable!==t&&(B.get(e).isEnable=t,t||T&&T[1].group===e&&Y.__hide(),Se(),oe(),ae())},z.selectBrushGroup=function(e){ye(e),oe(),ae()},z.getBrushesGroupSize=function(){return B.length},z.removeBrushGroup=function(e){if(B.length<=1)return;let t=B.keys(),n=t.next().value;n=n===e?t.next().value:n;let r=B.get(e);for(let[e,t]of r.brushes.entries())null!==t.selection?re([e,t]):(t.group=n,B.get(n).brushes.set(e,t),r.brushes.delete(e));G===e&&(B.get(n).isActive=!0,G=n),B.delete(e),ae()},z.getEnableGroups=function(){let e=new Set;return B.forEach(((t,n)=>{t.isEnable&&e.add(n)})),e},z.getBrushesGroup=function(){let e=new Map;return B.forEach(((t,n)=>{let r=Object.assign({},t);r.brushes=new Map(t.brushes),e.set(n,r)})),e.forEach((e=>{e.brushes.forEach(((t,n)=>{null===t.selection&&e.brushes.delete(n)}))})),e},z.getBrushGroupSelected=function(){return G},z.removeSelectedBrush=function(){T&&re(T)},z.getSelectedBrush=function(){return T},z.hasSelection=function(){return 0!==k},z.deselectBrush=function(){T&&(T=null,Se(),w(T))},z.changeSelectedBrushMode=function(e){T.mode=e,de(T)},z.changeSelectedBrushAggregation=function(e){T.aggregation=e,ne()},z.moveBrush=function([e,t],n,r=!1){let[[o,a],[i,s]]=n,l=u.domain()[0],c=u.domain()[1],h=d.domain()[0],f=d.domain()[1];o=Math.max(o,l),i=Math.min(i,c),a=Math.min(a,f),s=Math.max(s,h),l instanceof Date&&(o=new Date(o),i=new Date(i)),o>i&&([o,i]=[i,o]),a<s&&([a,s]=[s,a]);let p=u(o),g=u(i),m=d(a),b=d(s);A.selectAll("#brush-"+e).call(t.brush.move,[[p,m],[g,b]]),n=[[p,m],[g,b]];let v=[[o,a],[i,s]],y=new Event("move");r?ue({selection:n,sourceEvent:y},[e,t]):(te({selection:n,sourceEvent:y},[e,t]),Y.__update({selection:v,selectionPixels:n}))},z.moveSelectedBrush=function([[e,t],[n,r]],o=!1){T?z.moveBrush(T,[[e,t],[n,r]],o):P("ðŸš« ERROR moveSelectedBrush called but selectedBrush is falsy ",T)},z.invertQuery=function(e){let t=B.get(e).brushes,n=Number.MAX_VALUE,r=Number.MIN_VALUE;t.forEach((e=>{e.selection&&(n=Math.min(e.selection[0][1],n),r=Math.max(e.selection[1][1],r))}));let o=(r-n)/2+n;t.forEach(((e,t)=>{if(!e.selection)return;let n=(e.selection[1][1]-e.selection[0][1])/2+e.selection[0][1];ce([t,e],0,2*(o-n))})),M()},z.invertQuerySelectedGroup=function(){z.invertQuery(G)},z.addFilters=function(e,t=!1){if(e instanceof Map&&(e=Array.from(e.values())).forEach((e=>e.brushes=Array.from(e.brushes.values()))),0!==e.length){t?B.clear():B.forEach((e=>{e.brushes.forEach(((t,n)=>{t.selection||e.brushes.delete(n)}))}));for(let t of e){let e=ge(),n={isEnable:!t.isEnable||t.isEnable,isActive:!!t.isActive&&t.isActive,name:t.name,brushes:new Map};B.set(e,n),D.set(e,[]);for(const n of t.brushes)O(n.selectionDomain,u,d)||(n.selection?n.selectionDomain=ee(n.selection):n.selectionDomain=ee([[0,100],[0,100]])),J(n.mode,n.aggregation,e,n.selectionDomain),k++}J(),ne(),Se()}},z.drawBrushes=function(){Se()},z.setTsPosition=function(e){b=e};let Be=ge(),Ae={isEnable:!0,isActive:!0,name:"Group "+(Be+1),brushes:new Map};return B.set(Be,Ae),D.set(Be,[]),G=Be,B.get(Be).isEnable=!0,J(),Se(),z}({ts:st,element:Fe.node(),data:Ee,tooltipTarget:Re.node(),contextMenuTarget:Re.node(),width:Q,height:Z,xPartitions:fe,yPartitions:pe,x:s,y:l,brushShadow:ae,fmtY:p,fmtX:f,scaleX:Ne,scaleY:$e,updateTime:150,tsLevel:ot,selectionCallback:yt,groupsCallback:xt,changeSelectedCoordinatesCallback:gt,selectedBrushCallback:ht}),He.selectAll("text").data([1]).join("text").attr("x",0).attr("y",st.brushGroupSize/2+2).text("Groups + : ").style("cursor","pointer").on("click",ut),Ye.appendChild(Le),function(){Xe.innerHTML="";let e=n.select(Xe),t=e.append("div");t.append("span").text(S||"X Axis:");let r=t.append("div"),o=Ne.domain(),i=r.append("div").append("input").attr("type",Je?"Date":"number").attr("min",Je?f(o[0]):o[0]).attr("max",Je?f(o[1]):o[1]).attr("step",st.stepX).attr("width","50%").on("change",bt),s=r.append("div").append("input").attr("type",Je?"Date":"number").attr("min",Je?f(o[0]):o[0]).attr("max",Je?f(o[1]):o[1]).attr("width","50%").attr("step",st.stepX).on("change",bt),l=e.append("div");l.append("span").text(w||"Y Axis:");let c=l.append("div"),u=$e.domain(),d=c.append("div").append("input").attr("type","number").attr("min",u[0]).attr("max",u[1]).attr("width","50%").attr("step",st.stepY).on("change",bt),h=c.append("div").append("input").attr("type","number").attr("min",u[0]).attr("max",u[1]).attr("width","50%").attr("step",st.stepY).on("change",bt);lt=[[i,d],[s,h]],a&&(e.insert("h3",":first-child").text("Current TimeBox Coordinates:"),Le.appendChild(Xe))}(),Oe.innerHTML='<div style="flex-basis:100%;">\n    <div id="brushesList">\n    </div>\n    <button id="btnAddBrushGroup">Add Group</button>\n    </div>',Oe.querySelector("button#btnAddBrushGroup").addEventListener("click",ut),r&&(n.select(Oe).insert("h3",":first-child").text("Groups:"),Le.appendChild(Oe)),e}function gt(e){!function(e){if(e){let[[t,n],[r,o]]=e;if(lt){let[[e,a],[i,s]]=lt;e.node().value=f(t),i.node().value=f(r),a.node().value=p(o).replace("âˆ’","-"),s.node().value=p(n).replace("âˆ’","-")}else P("updateBrushSpinBox called, but brushSpinBoxes not ready ",lt)}else!function(){let[[e,t],[n,r]]=lt;e.node().value="",n.node().value="",t.node().value="",r.node().value=""}()}(e),wt()}function mt(){if(d){Pe.node().innerHTML="",Pe.append("span").text("Data groups: ");let e=Pe.selectAll(".groupData").data(Ze).join("div").attr("class","groupData");e.append("button").style("font-size",`${st.brushGroupSize}px`).style("stroke","black").style("margin","2px").style("margin-right","10px").style("border-width","3px").style("border","solid black").style("width",`${st.brushGroupSize}px`).style("height",`${st.brushGroupSize}px`).style("background-color",(e=>st.colorScale(e))).on("click",(function(e,t){Ze.has(t)?(Ze.delete(t),n.select(this).style("border","solid transparent")):(Ze.add(t),n.select(this).style("border","solid black")),yt()})),e.append("span").text((e=>e))}}function bt(e){if(null===it.getSelectedBrush())return;let t,n,[[r,o],[a,i]]=lt,s=Ne.domain(),l=+i.node().value,c=+o.node().value;Je?(t=new Date(r.node().value),n=new Date(a.node().value),t>=n&&(e.target===r.node()?(n=u(t,st.stepX),n=Math.min(n,s[1]),a.node().value=f(n)):(t=R(n,st.stepX),t=Math.max(t,s[0]),r.node().value=f(t)))):(t=+r.node().value,n=+a.node().value,t>=n&&(e.target===r.node()?(n=t+st.stepX,a.node().value=n):(t=n-st.stepX,r.node().value=t))),c>=l&&(e.target===o.node()?(l=c+st.stepY,i.node().value=l):(c=l-st.stepY,o.node().value=c)),it.moveSelectedBrush([[t,l],[n,c]])}function vt(e,t,n){let r=[],o=it.getEnableGroups();o.forEach((e=>{Ie.has(e)&&r.push([e,Ie.get(e)])}));let a=new Map,i=new Set(t);e.forEach(((e,t)=>{o.has(t)?a.set(t,e):e.forEach((e=>i.add(e)))}));let s=[];if(rt&&rt.forEach((e=>{if(e){let t=new Map;e.forEach(((e,n)=>{o.has(n)&&t.set(n,e)})),s.push(t)}else s.push(null)})),a.forEach((e=>i.delete(e))),t=Array.from(i),tt.render(a,it.getBrushGroupSelected(),Ke?t:[],r,n,s,ot,at),st.hasDetails){let t=it.getBrushGroupSelected();window.requestAnimationFrame((()=>et.render({data:e,brushGroupSelected:t})))}}function yt(e=Ue,t=Ve,n=it.hasSelection(),r=!0){Ue=e,Ve=t,d?[qe,Qe]=function(e,t){let n=new Map(e),r=t;for(let e of n){let t=e[1].filter((e=>Ze.has(d(e[1][0]))));n.set(e[0],t)}return r=r.filter((e=>Ze.has(d(e[1][0])))),[n,r]}(Ue,Ve):(qe=Ue,Qe=Ve),nt&&({renderSelected:qe,renderNotSelected:Qe}=function(e,t){if(!rt||0===ot)return{renderSelected:e,renderNotSelected:t};let n,r=new Set,o=new Map;for(let e=ot-1;e>=0;e--)if(rt[e]){n=e;break}if(void 0!==n){rt[n].forEach(((e,t)=>{let n=new Set;e.forEach((e=>{n.add(e[0]),r.add(e[0])})),o.set(t,n)}));let a=new Map;e.forEach(((e,t)=>{if(o.has(t)){let n=e.filter((e=>o.get(t).has(e[0])));a.set(t,n)}else a.set(t,e)}));let i=t.filter((e=>r.has(e[0])));return{renderSelected:a,renderNotSelected:i}}return{renderSelected:e,renderNotSelected:t}}(qe,Qe)),ie&&function(e){if(!it.hasSelection())return;let t=+Ne.domain()[0],n=(+Ne.domain()[1]-t)/st.medianNumBins;for(let r of e.entries()){let e=r[0],o=[],a=t;for(let e=0;e<st.medianNumBins;++e)o.push({x0:a,x1:a+n,data:[]}),a+=n;for(let e of r[1])for(let r of e[1]){let e=Math.floor((s(r)-t)/n);e=e>st.medianNumBins-1?e-1:e,o[e].data.push(l(r))}let i=[];for(let e of o)if(e.data.length>=st.medianMinRecordsPerBin){let t=e.x0+(e.x1-e.x0)/2,n=st.medianFn(e.data);i.push([t,n])}Ie.set(e,i)}P(" Bins computed",Ie)}(qe),vt(qe,Qe,n),ft(),St(qe),kt(qe,r)}function xt(){vt(qe,Qe,it.hasSelection()),ft(),St()}function wt(){let e=new Map;for(let[t,n]of it.getBrushesGroup()){let r={id:t,name:n.name,isActive:n.isActive,isEnable:n.isEnable,brushes:n.brushes};e.set(n.name,r)}Ye.value.status=e,Ye.dispatchEvent(new Event("input",{bubbles:!0}))}function St(e=qe){let t=new Map;for(let[n,r]of it.getBrushesGroup()){let o=new Map;e.get(n).forEach((e=>o.set(e[0],e[1]))),t.set(r.name,o)}Ye.value=t,Ye.value.groupsColorScale=L,Ye.value.nonSelectedIds=Ve.map((e=>e[0])),Ye.value.selectedIds=Ue.get(it.getBrushGroupSelected()).map((e=>e[0])),Ye.value.selectedGroup=it.getBrushesGroup().get(it.getBrushGroupSelected()).name,Ye.value.asArray=e=>function(e,{getRepresentative:t=(e=>e[0]),groupAttributeName:n="tw_group"}={}){return[...e.entries()].map((([e,r])=>[...r.values()].map((r=>{const o=t(r);return o[n]=e,o})))).flat()}(t,e),Ye.extent={x:Ne.domain(),y:$e.domain()},Ye.brushGroups=it.getBrushesGroup(),wt()}function kt(e,t){if(Bt(new CustomEvent("TimeWidget",{detail:{type:z.changeSelection,data:it.hasSelection()?e:null}})),t){Bt(new CustomEvent("TimeWidget",{detail:{type:z.update}}))}vt(qe,Qe,it.hasSelection())}function Bt(e){e.detail.sourceId=ot,nt&&nt.forEach(((t,n)=>{n!==ot&&t.dispatchEvent(e)}))}return Ye=n.select(t).style("display","flex").style("flex-wrap","wrap").style("position","relative").style("top","0px").style("left","0px").style("background-color",st.backgroundColor).node(),n.select(t).on("TimeWidget",(function(e){let t=e.detail;switch(P("customEvent","destination",ot,"source",t.sourceId,t.type),t.type){case z.changeSelection:rt[t.sourceId]=t.data;break;case z.update:n=t.sourceId,t.data,ot<=n?vt(qe,Qe,it.hasSelection()):yt(Ue,Ve,it.hasSelection(),!1);break;case z.addBrushGroup:it.addBrushGroup();break;case z.removeBrushGroup:it.removeBrushGroup(t.data);break;case z.selectBrushGroup:it.selectBrushGroup(t.data);break;case z.changeBrushGroupState:it.changeBrushGroupState(t.data.id,t.data.newState);break;case z.deselectAllBrushes:it.deselectBrush();break;case z.highlightSelection:at=t.data?{positionTs:t.data.positionTs,groupId:t.data.groupId}:null,vt(qe,Qe,it.hasSelection());break;case z.changeNonSelected:Ke=t.data.newState,yt();break;default:P("unsupported event",t)}var n})),n.select(t).on("input",(function(){P("Oninput test")})),Le=Le||n.select(t).select("#control").node()||n.create("div").attr("id","control").node(),Xe=Xe||n.select(t).select("#brushesCoordinates").node()||n.create("div").attr("id","brushesCoordinates").node(),Oe=Oe||n.select(t).select("#brushesGroups").node()||n.create("div").attr("id","brushesGroups").node(),Ie=new Map,Ue=new Map,Ve=[],Ze=new Set,Ke=!0,rt=[],st.addReferenceCurves=function(e){if(!Ne)return;if(!Array.isArray(e))throw new Error("The reference curves must be an array of Objects");let t=Ne.domain(),r=$e.domain();e.forEach((e=>{e.data.sort(((e,t)=>n.ascending(s(e),s(t)))),e.data=e.data.filter((e=>e[0]>=t[0]&&e[0]<=t[1]&&e[1]>=r[0]&&e[1]<=r[1]))}));let o=n.line().defined((e=>void 0!==e[1]&&null!==e[1])).x((e=>Ne(e[0]))).y((e=>$e(e[1])));We.selectAll(".referenceCurve").data(e).join("path").attr("class","referenceCurve").attr("d",(e=>o(e.data))).attr("stroke-width",(e=>e.strokeWidth||2)).style("fill","none").style("stroke",(e=>e.color)).style("opacity",(e=>e.opacity))},st.addAlgebraicLine=function(e,t={}){if(!Ne)return;const{color:n="#ff0000",opacity:r=.8,strokeWidth:o=2,numPoints:a=100,xRange:i=null}=t,s=i||Ne.domain(),[l,c]=s,u=(c-l)/(a-1),d=[];for(let t=0;t<a;t++){const n=l+t*u;try{const t=e(n);isFinite(t)&&d.push([n,t])}catch(e){continue}}if(0===d.length)return;const h={data:d,color:n,opacity:r,strokeWidth:o};st.addReferenceCurves([h])},st.updateCallback=function(e){return arguments.length?(re=e,st):re},st.statusCallback=function(e){return arguments.length?(oe=e,st):oe},st.notifyParent=function(e,n){return e.unshift(t),nt=Me?Me.notifyParent(e,n+1):e,ot=nt.length-1-n,it&&it.setTsPosition(ot),Ee&&kt(qe,!1),nt},st.data=function(r){P(" Processing data: ... ",(e=r).length),De=e.filter((e=>void 0!==l(e)&&null!==l(e)&&void 0!==s(e)&&null!==s(e))),function({xDataType:e,fData:t}){y||(y=ke&&Se?Se.extent.x:n.extent(t,s)),Ne=b?b.copy():void 0,"object"===e&&s(t[0])instanceof Date?(Je=!0,Ne||(Ne=n.scaleTime()),Ne.domain(y),f?"M"===f.name&&(console.log('ðŸ‘ï¸t has been detected that the parameter fmtX formats numerical data, while the data selected for the X-axis is a date. The function d3.timeFormat("%Y-%m-%d") will be used as fmtX; '),f=n.timeFormat("%Y-%m-%d")):f=n.timeFormat("%Y-%m-%d")):(Ne||(Ne=n.scaleLinear()),Ne.domain(y),f||(f=n.format(".1f"))),Ne.range([0,Q-st.margin.right-st.margin.left]).nice(),x||(x=ke&&Se?Se.extent.y:n.extent(t,l)),$e=v.copy(),$e.domain(x),$e.range([Z-st.margin.top-st.margin.bottom,0]).nice().clamp(!0)}({xDataType:typeof s(De[0]),fData:De}),De=De.filter((e=>!isNaN(Ne(s(e)))&&!isNaN($e(l(e))))),Ee=n.groups(De,c),Ee.map((e=>[e[0],e[1].sort(((e,t)=>n.ascending(s(e),s(t))))])),st.alphaScale.domain([0,Ee.length]),he&&(Ee=Ee.slice(0,he)),pt(),tt.setScales({scaleX:Ne,scaleY:$e}),tt.data(Ee),mt(),function({overviewX:e,overviewY:r}){st.hasDetails&&(je||(je=n.select(t).select("#details").node()||n.create("div").attr("id","#details").node()),et=W({ts:st,detailsElement:je,detailsContainerHeight:ee,detailsWidth:K,maxDetailsRecords:de,detailsHeight:J,x:s,y:l,margin:ne}),et.setScales({overviewX:e,overviewY:r}),i&&Ye.appendChild(je))}({overviewX:Ne,overviewY:$e}),Ue.set(0,[]),qe=Ue,Ve=Ee,Qe=Ve,Se?it.addFilters(Se.value.status,!0):A&&it.addFilters(A,!0),yt()},Me&&(st.notifyParent([],0),rt[ot]=null),e&&s&&l&&c?st.data(e):(Ne=n.scaleLinear().range([0,Q-st.margin.right-st.margin.left]),$e=n.scaleLinear().range([Z-st.margin.top-st.margin.bottom,0]).nice().clamp(!0),pt()),h&&st.addReferenceCurves(h),st.render=()=>{yt()},Ye.ts=st,Ye.details=je,Ye.brushesCoordinates=Xe,Ye.groups=Oe,Ye}}));
